\documentclass[a4paper]{article}

%\documentclass[smallextended]{svjour3} 
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage{url}
\usepackage{pgf, tikz}
\usepackage{mathrsfs}
\usetikzlibrary{arrows, arrows.meta, decorations.pathmorphing, backgrounds, fit, positioning, shapes.symbols, shapes.geometric, chains}
\usepackage[T1]{fontenc}
\usepackage{csquotes}
\usepackage{scalerel}
\usepackage{float, subfig}
\usepackage{booktabs}

\usepackage{comment}

\newcommand{\lbrakk}{\llbracket}
\newcommand{\rbrakk}{\rrbracket}
\newcommand{\tab}{\hspace{5mm}}
\DeclareMathOperator{\arccosh}{arccosh}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Real}{Re}
\DeclareMathOperator{\Imag}{Im} 
\DeclareMathOperator{\atanh}{atanh}


\makeatletter
\newsavebox{\@brx}
\newcommand{\llangle}[1][]{\savebox{\@brx}{\(\m@th{#1\langle}\)}%
  \mathopen{\copy\@brx\kern-0.5\wd\@brx\usebox{\@brx}}}
\newcommand{\rrangle}[1][]{\savebox{\@brx}{\(\m@th{#1\rangle}\)}%
  \mathclose{\copy\@brx\kern-0.5\wd\@brx\usebox{\@brx}}}
\makeatother

\newcommand{\C}[0]{\ensuremath{\mathbb{C}}}
\newcommand{\CPone}[0]{\ensuremath{\C{}P^1}}
\newcommand{\extC}[0]{\ensuremath{\overline{\C}}}

\newcommand{\betweenSymbol}{\raisebox{0.4ex}{\ensuremath{\mathord{\includegraphics[width=0.7em]{Images/between_symbol.eps}}}}}

\newcommand{\bT}[3]{{#1} \betweenSymbol {#2} \betweenSymbol {#3}}
\newcommand{\congT}[2]{{#1} \mathbin{\equiv} {#2}}
\newcommand{\imp}{\Rightarrow}

\captionsetup[subfloat]{labelformat=empty}

\newcommand{\smallfigs}[2]{\centering
\scalebox{0.8}{\subfloat[]{#1}}
\qquad
\scalebox{0.8}{\subfloat[]{#2}}}

\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
%\smartqed 

\begin{document}
\begin{abstract}
  In this paper, we present an Isabelle/HOL formalization of
  non-commu\-ta\-ti\-ve and non-associative algebraic structures known
  as \emph{gyrogroups} and \emph{gyrovector spaces}. These concepts
  were introduced by Abraham A. Ungar and have deep connections to
  hyperbolic geometry and special relativity. Gyrovector spaces can be
  used to define models of hyperbolic geometry. Unlike other models,
  gyrovector spaces offer the advantage that all definitions exhibit
  remarkable syntactical similarities to standard Euclidean and
  Cartesian geometry (e.g., points on the line between $a$ and $b$
  satisfy the parametric equation
  $a \oplus t\otimes(\ominus a \oplus b)$, for $t \in \mathbb{R}$,
  while the hyperbolic Pythagorean theorem is expressed as
  $a^2\oplus b^2 = c^2$, where $\otimes$, $\oplus$, and $\ominus$
  represent gyro operations).

  We begin by formally defining gyrogroups and gyrovector spaces and
  proving their numerous properties. Next, we formalize M\"obius and
  Einstein models of these abstract structures, and then demonstrate
  that these are equivalent to the Poincar\'e and Klein-Beltrami
  models, satisfying Tarski's geometry axioms for hyperbolic geometry.
  
\end{abstract}

\section{Introduction}

Non-Euclidean geometries, including hyperbolic geometry, have been
studied since the 19th century, and their properties are now well
understood. Applications of hyperbolic geometry in physics have also
been widely explored, with findings indicating that hyperbolic
geometry provides the mathematical foundation for the theory of
special relativity, just as Euclidean geometry underpins classical
Newtonian and Galilean mechanics.

Analytic definitions of hyperbolic geometry are typically framed in
the extended complex plane, heavily relying on linear algebra
techniques (such as Hermitian matrices) and hyperbolic trigonometry
\cite{schwerdtfeger}. Unlike the Cartesian approach used in
Euclidean geometry, hyperbolic geometry does not incorporate vectors
in the same manner. In Euclidean geometry, vectors form a natural
framework: vector addition is associative and commutative, forming an
Abelian group, and vectors can be scaled by real numbers, creating a
vector space. The dot (inner) product and vector norm are easily
defined, establishing the Euclidean metric,
$d(A, B) = \vert\overrightarrow{AB}\vert$. However, these concepts are
not as straightforward to define in the hyperbolic plane, leading to
analytic definitions of hyperbolic geometry that do not employ vector
spaces. This results in an inherent asymmetry between the definitions
of Euclidean and hyperbolic geometry.


In 1988, Ungar \cite{ungar-analytic} proposed an alternative and
developed algebraic structures known as \emph{gyrogroups} and
\emph{gyrovector spaces}, enabling the definition and use of
``vectors'' for the formalization of hyperbolic geometry. Although
operations with these ``vectors'' do not form traditional vector
spaces—vector addition, for instance, is neither commutative nor
associative—the elements, called gyrovectors, along with their
associated operations, satisfy enough algebraic properties to allow a
formalism of hyperbolic geometry that is strikingly similar in syntax
to the classical treatment of Euclidean geometry.

Interestingly, these structures were first discovered through an
examination of Einstein's velocity addition laws, which were then
unified with classical Galilean velocity addition. This unification
revealed a deep connection between the special theory of relativity
and hyperbolic geometry. The experimentally discovered Thomas
precession (also known as Thomas gyration) was identified as a
``missing link'' between Einstein's velocity addition formula and
ordinary vector addition.\cite{ungar-analytic}

In this paper, we present a formalization of gyrovector spaces and
their connections with hyperbolic geometry and special relativity,
within the interactive theorem prover Isabelle/HOL.\footnote{The full
  formalization is available at
  \url{https://github.com/jecamark96/moebius}} Machine-verified proofs
are gaining popularity, and with recent advances in AI, it may only be
a matter of time before they become the norm. Such proofs are
particularly valuable in areas prone to error; we argue that
non-associative and non-commutative algebras belong to this category.
Namely, human mathematicians, accustomed to the standard laws of
groups and vector spaces, may make assumptions in pen-and-paper proofs
that seem valid to those not specifically trained to think within
non-commutative and non-associative structures. Additionally, since
most gyrogroup and gyrovector space laws are expressed as equalities,
automated provers, especially those based on term rewriting, often
find proofs that are shorter and more elegant than those produced by
humans. We support this claim by providing several examples.

We follow the book \cite{ungar-analytic}, while filling in many
important details that are omitted in the original text. This includes
making the underlying notation more precise and providing many proofs
missing from the book.

The paper is structured as follows. First, we describe the
formalization of gyrogroups (Section \ref{sec:gyrogroups}) and
gyrovector spaces (Section \ref{sec:gyrovectorspaces}), defining these
abstract structures and proving their essential properties. In Section
\ref{sec:mobiuseinstein}, we formally demonstrate that M\"obius
transformations, traditionally used to define hyperbolic geometry,
give rise to gyrogroup and gyrovector space structures (formalizing
the so-called M\"obius gyrovector spaces). We also formally prove that
Einstein's velocity addition follows the same structure (formalizing
the so-called Einstein gyrovector spaces). In Section
\ref{sec:models}, we employ gyrovector spaces to define hyperbolic
geometry in a syntactically elegant manner. We then prove that these
definitions yield models equivalent to the Poincar\'e and
Klein-Beltrami disks. Finally, in Section \ref{sec:conclusions}, we
present our conclusions and propose potential directions for future
work.

\subsection{Related work}

Over the past decade, significant progress has been made in
formalizing various geometries and their models using proof
assistants.

GeoCoq\footnote{https://geocoq.github.io/GeoCoq/}, developed by
Narboux et al., is a formalization of geometry using the Coq proof
assistant. It contains a formalization of a systematic development of
Euclidean geometry based on Tarski's axioms
\cite{tarski,narboux-tarski}. Magaud, Narboux and Schreck investigated
how projective plane geometry can be formalized in a proof assistant
\cite{coq-projective}. Narboux, Boutry and Braun used a proof
assistant Coq to formaly prove that Tarski's axioms for plane neutral
geometry can be derived from the corresponding Hilbert's
axioms\cite{hilbert-to-tarski}. They have also mechanized the proof
that Tarski's version of the parallel postulate is equivalent to the
Playfair's postulate used by Hilbert\cite{coq-parallels} and proved
that Hilbert's axioms for plane neutral geometry (excluding
continuity) can be derived from the corresponding Tarski’s
axioms\cite{tarski-to-hilbert}.

Petrovi\'c and Mari\'c describe formalization of analytic geometry of
the Cartesian plane in Isabelle/HOL \cite{adg-analytic}. Boutry, Braun
and Narboux describe the formalization of the arithmetization of
Euclidean plane geometry in the Coq proof assistant, developing
analytic geometry of the Cartesian within the Tarski's axiom
system\cite{aritmetization}.

Makarios formalized Klein/Beltrami disc model of hyperbolic geometry
in the projective space $\mathbb{R}P^2$ in
Isabelle/HOL\cite{makarios}. Based on the work of Makarios, Harrison
has shown the independence of Euclid's axiom in HOL-Light, and
Coghetto formalized the Klein-Beltrami model within
Mizar\cite{harrison2005hol,coghetto2018klein}. Mari\' c and Simi\' c
formally addressed the geometry of complex numbers and presented a
fully mechanically verified development within the theorem prover
Isabelle/HOL\cite{amai-complexplane}. Simi\' c, Mari\' c and Boutry
developed a formalization of the Poincar\'e disc model of hyperbolic
geometry within the Isabelle/HOL proof
assistant\cite{amai-poincare}. They showed that model is defined
within the complex projective line $\mathbb{C}P^1$ and adheres to
Tarski’s axioms, except for Euclid’s axiom, which it negates while
satisfying the existence of limiting parallels. The formalization
follows Schwerdfeger's book\cite{schwerdtfeger} based on linear
algebra (points are represented by vectors of complex homogenous
coordinates, circles and lines are represented by Hermitean matrices,
and M\"obius transformations by non-degenerate matrices). Our paper
builds upon this work, leveraging some of the established
results. This connection is elaborated further in Section
\ref{sec:models}.

\subsection{Background}\label{sec:background}

In this section we will describe
Isabelle/HOL\footnote{https://isabelle.in.tum.de/} and its main
features that are used for our formalization.

Isabelle is a generic proof assistant that supports various logics,
with the most popular being HOL (Higher-Order Logic). Users specify
mathematical theories, defines new concepts, states their properties
and provides proofs written in a specialized, declarative proof
language called Isar\cite{isar}. These proofs are checked by the
system, guaranteeing their correctness.

Algebraic structures are formalized using
locales\cite{isabelle-locales} and classes\cite{isabelle-classes}. In
Isabelle/HOL, \emph{locales} are particularly useful for defining and
reasoning about algebraic structures such as groups, rings, and vector
spaces, where common assumptions (like associativity, identity
elements, and distributivity) are essential across different proofs. A
locale allows users to define a set of operations and assumptions that
characterize an algebraic structure and then apply these assumptions
across multiple contexts without repeating foundational setup. Within
a locale, the \textbf{fixes} keyword is used to declare parameters,
like specific operations or elements (e.g., a binary operation
$\oplus$ and an identity element $e$ in a group). The \textbf{assumes}
keyword is used to specify the properties or axioms these parameters
must satisfy (e.g., associativity of $\oplus$ and the identity
property of $0$). The \textbf{interpretation} command is used to
instantiate a locale with specific parameters and assumptions (for
example to show that integers form a group when neutral $e$ is
interpreted by $0$ and the group operation $\oplus$ is interpreted by
integer addition $+$), effectively importing theorems and definitions
from the locale into a new context. This allows the user to apply the
abstract properties and results of an algebraic structure to concrete
examples, enabling seamless reuse of previously proven theorems under
the given interpretation.

Algebraic structures that have just a single operation are specified
using \emph{type classes} (very similar to Haskell)
\cite{isabelle-classes}. Classes are very similar to locales but the
main difference is that classes are suitable for defining type-based
properties and structures, while locales are more general and flexible
for organizing proofs and theories with shared assumptions and
parameters.

The \emph{lifting/transfer package}\cite{isabelle-lifting-transfer} is
used to transfer definitions and theorems from the raw type to the
abstract type. In Isabelle/HOL, an abstract type is a type defined in
terms of properties and behaviors rather than concrete
representation. Examples of abstract types include subset types,
quotient types, etc. Subset types are defined using \textbf{typedef}
construction. For example, the set of points in the Poincar\'e disc
can be defined as a subtype of complex numbers, containing the
elements whose norm is less than 1. Two functions are automatically
generated (assuming the concrete type is called $B$ and the abstract
type is called $A$): $\mathit{Rep\_A}$ and $\mathit{Abs\_A}$. The role
of $\mathit{Rep\_A}$ is to map an element of the new, abstract type to
its representation in the underlying type (for example,
$\mathit{Rep\_Poincare}$ maps a point of the Poincar\'e disc into its
representing complex number). $\mathit{Abs\_A}$ is essentially the
inverse function of $\mathit{Rep\_A}$ whose role is to map an element
of the underlying type to an element of the new, abstract type,
provided that the element satisfies the predicate defining the subset
(for example, $\mathit{Abs\_Poincare}$ maps a complex number with norm
less than one into a point of the Poincar\'e disc).

Functions on the abstract type can be defined by first defining
functions on the underlying representation type, and then lifting
those definitions to the abstract type, by means of lifting/transfer
package\cite{isabelle-lifting-transfer}. Such definition use the
keyword \textbf{lift\_definition}. For example, functions that operate
on points in the Poincar\'e disc can be defined by defining functions
that operate on complex numbers, and then lifting them to the subtype.
Proofs about such functions can be done by transfering them from the
abstract type to the representation type.

\section{Gyrogroups}\label{sec:gyrogroups}

In this section we give a definition of a gyrogroup, a nonassociative
group-like structure that was discovered by
Ungar\cite{ungar-analytic}. In the same way that groups serve as a
bridge between associative algebra and Euclidean geometry, gyrogroups
serve as a bridge between nonassociative algebra and hyperbolic
geometry and relativistic physics. They are the foundation on which
analytic hyperbolic geometry rests.

\begin{definition} \textbf{(Grupoid)} A structure $(G, \oplus)$ where
  $\oplus$ is a binary operation is a \emph{grupoid} if $G$ is a
  non-empty set closed for $\oplus$.
\end{definition}

\begin{definition} \textbf{(Automorphism)} An \emph{automorphism} of a
  groupoid $(G , \oplus)$ is a bijective self-map of $S$ ,
  $ \phi: G \rightarrow G$ , which preserves its groupoid operation,
  that is, $\phi (a\oplus b) = \phi (a) \oplus \phi (b)$ for all
  $a, b\in G$.
\end{definition}

\begin{definition} \textbf{(Gyrogroups \cite{ungar-analytic},
    Definition 2.5)} A grupoid $(G, \oplus)$ is a \emph{gyrogroup} if
  its binary operation satisfies the following axioms.
\begin{itemize}
\item[(G1)] There is at least one element in $G$ called a left
  identity ($0$) that satisfies $0\oplus a = a$ for all $a\in G$.
  
\item[(G2)] For each element $a\in G$ there exists an element
  $\ominus a\in G$ called a left inverse such that
  $\ominus a \oplus a = 0$.
  
\item[(G3)] For any $a, b, c \in G$ there exists a unique element
  $gyr[a,b]c$ from $G$ such that a left gyroassociative law is
  obeyed. It means that:
  
  $$a\oplus (b \oplus c) = (a\oplus b) \oplus gyr[a,b]c$$
  
\item[(G4)] The map $gyr[a, b] : G \rightarrow G$ given by
  $c \mapsto gyr[a, b]c$ is an automorphism of the groupoid
  $(G, \oplus)$, that is,

  $$gyr[a, b] \in Aut(G, \oplus)$$
  
  and the automorphism $gyr[a, b]$ of $G$ is called the
  gyroautomorphism, or the gyration, of $G$ generated by $a$,
  $b \in G$. The operator
  $gyr : G \times G \rightarrow Aut(G, \oplus)$ is called the gyrator
  of $G$.
\item[(G5)] Finally, the gyroautomorphism $gyr[a, b]$ generated by any
  $a, b \in G$ possesses the left reduction property:
  
  $$gyr[a, b] = gyr[a\oplus b, b]$$ 
\end{itemize}
\end{definition}

From these axioms, it can be easily shown that there is an unique
identity $0$ (both left and right) and that every element $a\in G$ has
its own unique inverse (both left and right). The structure of a
gyrogroup is a very rich structure, and many lemmas and theorems
follow from these axioms. We give example of one simple (but not
trivial) lemma with a proof.

\begin{lemma}\label{lemma:left_cancel} \textbf{(General left cancellation law):} Let
  $(G,\oplus)$ be a gyrogroup. For any elements $a$, $b$, $c\in G$ we
  have: If $a\oplus b=a\oplus c$ then $b=c$.
\end{lemma}
\begin{proof} From $(G2)$ we know that there must exist an element $x$
  such that $x\oplus a = 0$ where $0$ is a left identity. From $(G3)$
  we conclude that
  $x\oplus (a\oplus b) = (x \oplus a) \oplus gyr[x,a]b$ which is also
  equal to $gyr[x,a]b$ since $0$ is a left identity. On the other
  hand, $x\oplus (a\oplus b)=x\oplus (a\oplus c)$ because
  $a\oplus b=a\oplus c$ is a condition of this lemma. Moreover, from
  $(G3)$ we also know that
  $x\oplus (a\oplus c) = (x \oplus a) \oplus gyr[x,a]c =
  gyr[x,a]c$. So, finally, we have that $gyr[x,a]b=gyr[x,a]c$. From
  this equation the result follows very easy, since gyroautomorphisms
  are bijective functions.
\end{proof}

\subsection{Isabelle/HOL formalization}

Formalization of gyrogroups in Isabelle/HOL is very
straightforward. Since it is an algebraic operation on a single type
we define it as a type class\cite{isabelle-classes}. First we define a
groupoid and a groupoid automorphism.

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf class} gyrogroupoid =\\
\> {\bf fixes} gyrozero :: "'a ("$0_g$")"\\
\> {\bf fixes} gyroplus :: "'a  $\Rightarrow$  'a  $\Rightarrow$  'a" (infixl "$\oplus$" 100)"\\
{\bf begin}\\[1mm]
{\bf definition} gyroaut :: "('a $\Rightarrow$ 'a) $\Rightarrow$ bool {\bf where}\\
\>    "gyroaut f $\longleftrightarrow$ 
       ($\forall$ a b. f (a $\oplus$ b) = f a $\oplus$ f b) $\land$ 
       bij f"\\[1mm]
       {\bf end}
\end{tabbing}
}
\end{small}

Next we define a gyrogroup. We define subtraction using addition and
left inverse.
     
\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf class}  gyrogroup  =  gyrogroupoid  +\\
\> {\bf fixes} gyroinv :: "'a $\Rightarrow$ 'a" ("$\ominus$")\\
\> {\bf fixes} gyr :: "'a $\Rightarrow$ 'a $\Rightarrow$ 'a $\Rightarrow$ 'a" \\
\> {\bf assumes} gyro\_left\_id: "\= $\bigwedge$ a. ($0_g$ $\oplus$ a = a)"\\
\> {\bf assumes} gyro\_left\_inv: "\=$\ominus$ a $\oplus$ a = $0_g$"\\
\> {\bf assumes} gyro\_left\_assoc: \\ \tab \tab "$\bigwedge$ a b z. a $\oplus$ (b $\oplus$ z) = (a $\oplus$ b) $\oplus$ (gyr a b z)"\\
\> {\bf assumes} gyr\_gyroaut: "$\bigwedge$ a b. gyroaut (gyr a b)"\\
\> {\bf assumes} gyr\_left\_loop: "$\bigwedge$ a b. gyr a b = gyr (a $\oplus$ b) b"\\
{\bf begin}\\[1mm]
{\bf definition} gyrominus :: "'a $\Rightarrow$ 'a $\Rightarrow$ 'a" (infixl "$\ominus_b$" 100) {\bf where}\\
\>    "a $\ominus_b$ b = a $\oplus$ ($\ominus$ b)"\\[1mm]
{\bf end}
\end{tabbing}
}
\end{small}


Our particullar interest is in gyrocommutative gyrogroups, since, as
we will see, some of them give a rise to gyrovector spaces.


\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf class} gyrocommutative\_gyrogroup = gyrogroup + \\
\> {\bf assumes}  gyro\_commute: "a $\oplus$ b = gyr a b (b $\oplus$ a)"
\end{tabbing}
}
\end{small}

Lemma \ref{lemma:left_cancel} can be formulated and proved in the Isar language as follows:

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\hspace{5mm}\=\kill
{\bf lemma} gyro\_left\_cancel:\\
\>  {\bf assumes} "a $\oplus$ b = a $\oplus$ c"\\
\>  {\bf shows} "b = c"\\
{\bf proof}-\\
\>  {\bf from} assms {\bf have} "($\ominus$a) $\oplus$ (a $\oplus$ b) = ($\ominus$a) $\oplus$ (a $\oplus$ c)" {\bf by} simp\\
\>  {\bf then} {\bf have} "($\ominus$a $\oplus$ a) $\oplus$ gyr ($\ominus$a) a b = ($\ominus$a $\oplus$ a) $\oplus$ gyr ($\ominus$a) a c"\\
\>\>    {\bf using} gyro\_left\_assoc {\bf by} simp\\
\>  {\bf then} {\bf have} "gyr ($\ominus$a) a b = gyr ($\ominus$a) a c" {\bf by} simp\\
\>  {\bf then} {\bf show} "b = c" {\bf using} gyr\_inj {\bf by} blast\\
{\bf qed}
\end{tabbing}
}
\end{small}

However, good support for automated theorem proving in Isabelle/HOL
can provide a much shorter proof than the one given in the
book. Namely, the prover metis shows the lemma fully automatically,
given a list of axioms and previous lemmas used in that automated
proof. This proof (including the relevant list of lemmas) is found by
the tool Sledgehammer\cite{sledgehammer}.

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf lemma} gyro\_left\_cancel:\\
\>  {\bf assumes} "a $\oplus$ b = a $\oplus$ c"\\
\>  {\bf shows} "b = c"\\
{\bf using} assms\\
{\bf by} (metis gyr\_inj gyro\_left\_assoc gyro\_left\_id gyro\_left\_inv)
\end{tabbing}
}
\end{small}

We have formally proved a large number of lemmas and theorems about
gyrogroups (given in Chapter 2 and 3 in \cite{ungar-analytic}). Our
experience shows that the support for automated theorem proving in
Isabelle/HOL, especially in the domain of equational reasoning that
lies in the core of the proofs of gyrogroup properties, and the
Sledgehammer tool for proof finding are very powerful, so we managed
to prove many theorems that have long elaborate proofs in the book
fully automatically (of course, such proofs do not give understanding
why the statement holds).

\section{Gyrovector spaces}\label{sec:gyrovectorspaces}

Gyrogroups are used to define gyrovectors and gyrovector spaces.

\begin{definition} \textbf{(Real Inner Product Gyrovector Spaces, Definition 6.2 in
    \cite{ungar-analytic})} A real inner product gyrovector space
  $(G, \oplus, \otimes)$ (gyrovector space, in short) is a
  gyrocommutative gyrogroup $(G, \oplus)$ that obeys the following
  axioms:
\begin{itemize}
\item[(1)] $G$ is a subset of a real inner product vector space $V$
  called the \emph{carrier} of $G$, $G \subseteq V$, from which it
  inherits its inner product, $\cdot$, and norm, $\lVert \cdot \rVert$
  which are invariant under gyroautomorphisms, that is,
  
  $$gyr[u, v ] a \cdot gyr [ u , v]b = a \cdot b$$

  for all points $a, b, u, v \in G$.
  
\item[(2)] $G$ admits a \emph{scalar multiplication}, $\otimes$ ,
  possessing the following properties. For all real numbers $r$,
  $r_1$,
  $r_2 \in \mathbb{R}$ and all points $a \in G$:\\[2mm]
  \begin{tabular}{cll}
    (V1) & $1\otimes a = a$ & \\[1mm]
    (V2) & $(r1 + r2) \otimes a = (r1 \otimes a) \oplus (r2 \otimes a)$ & Scalar Distributive Law\\[1mm]
    (V3) & $(r_1r_2)\otimes a = r_1 \otimes (r_2 \otimes a)$ & Scalar Associative Law\\[1mm]
    (V4) & $\frac{|r|\otimes a}{\lVert r \otimes a \rVert} = \frac{a}{\lVert a \rVert}$ & Scaling Property\\[1mm]
    (V5) & $gyr[u,v](r\otimes a) = r \otimes gyr[u,v]a$ & Gyroautomorphism Property\\[1mm]
    (V6) & $gyr[r_1\otimes v, r_2 \otimes v] = I$ & Identity Automorphism\\
  \end{tabular}

\item[(3)] Real vector space structure
  ($\lVert G \rVert, \oplus, \otimes$) for the set $\lVert G \rVert$
  of one-dimensional "vectors":

  $$\lVert G \rVert = \{\pm \lVert a \rVert:a\in G\}\subseteq \mathbb{R}$$
  
  with vector addition $\oplus$ and scalar multiplication $\otimes$, such that for all $r\in \mathbb{R}$ and $a, b \in G$,\\[2mm]
  \begin{tabular}{cll}
    (V7) & $\lVert r\otimes a \rVert = |r| \otimes \lVert a \rVert$ & Homogeneity Property\\[1mm]
    (V8) & $\lVert a \oplus b \rVert \leq \lVert a \rVert \oplus \lVert b \rVert$ & Gyrotriangle Inequality\\ 
  \end{tabular}
\end{itemize}
\end{definition}

\subsection{Isabelle/HOL formalization}

The use of operations might look ambiguous in some axioms, and this
must be clarified in the formalization.

The first unclear place is the axiom $V4$. It uses a division -- an
operation which is at first sight not present in the structure
$(G, \otimes, \oplus)$. A closer look reveals that, since $G$ must be
a subset of some real inner product vector space $V$, ,,vectors'' from
$G$ can be multiplied by scalars from the field (in this case the
field is $\mathbb{R}$) and also by their inverses (which explains a
division in axiom $V4$). Note that the denominators
$\lVert r \otimes a \rVert$ and $\lVert a \rVert$ are real
numbers. Therefore, $V4$ uses both the gyro scalar multiplication
$\otimes$ (of $|r| \in \mathbb{R}$ and $a \in G$) and the scalar
multiplication of the inner product space (of
$\frac{1}{\lVert r \otimes a \rVert} \in \mathbb{R}$ and
$|r|\otimes a \in G$).

Operands of $\oplus$ and $\otimes$ in axioms $V7$ and $V8$ are real
numbers. In these axioms these real numbers (norms of some
gyrovectors) are treated as elements of $G$, which is in accordance to
the requirement that the set
$\Vert G \rVert = \{\pm \lVert a \rVert:a\in G\}$ is a vector space
wrt. the operations $\oplus$ and $\otimes$. Therefore, real numbers
must be embedded into $G$, i.e., there must be exist a conversion from
real numbers to elements of $G$. There is a very natural way to do
that. Since all $n$-dimensional real inner product spaces are
isomorphic to $\mathbb{R}^n$, a real number $x$ can be converted into
a vector $(x, 0, \ldots, 0)$. Note that that such embedding is
traditionally present in the expositions of Euclidean geometry (the
same notation $+$ and $\cdot$ is used for addition and scalar
multiplication of vectors and addition and scalar multiplication of
their norms -- norms are a real number and they are identified with
one-dimensional vectors). Also note that in gyrovector spaces the
operations $\oplus$ and $\otimes$ have different properties when they
operate on $G$ and on $\lVert G\rVert$ (for example, in
$\lVert G \rVert$ case addition $\oplus$ is associative and
commutative).

With this in mind, we can formalize gyrovector spaces. To formalize
relationship between $G$ and its carrier $V$ (it holds that
$G \subseteq V$) we use explicit embedding function
$\mathit{to\_carrier}$ that maps elements of $G$ to their formal
counterparts in $V$. It's inverse function (on the part of $V$ that
corresponds to $G$) is denoted by $\mathit{of\_carrier}$. The function
$\mathit{in\_domain}$ checks if the given element is in the part of
$V$ that corresponds to $G$. Norm and inner product are inherited from
the carrier space $V$.

\begin{small}
{\tt
\begin{tabbing}
  \hspace{5mm}\=\hspace{5mm}\=\kill
  {\bf locale} gyrocarrier' = \\
\>  {\bf fixes} to\_carrier :: "'a::gyrocommutative\_gyrogroup $\Rightarrow$ 'b::real\_inner"\\
\>  {\bf fixes} of\_carrier :: "'b $\Rightarrow$ 'a"\\
\>  {\bf fixes} in\_domain :: "'b $\Rightarrow$ bool"\\
\>  {\bf assumes} to\_carrier:\\
\>\>"$\bigwedge$ b. in\_domain b $\Longrightarrow$ to\_carrier (of\_carrier b) = b"\\
\>  {\bf assumes} of\_carrier: "$\bigwedge$ a. of\_carrier (to\_carrier a) = a"\\
\>  {\bf assumes} to\_carrier\_zero: "to\_carrier $0_g$ = $0$"\\
{\bf begin}\\[1mm]
{\bf definition} gyronorm :: "'a $\Rightarrow$ real" ("$\llangle$\_$\rrangle$" [100] 100) {\bf where}\\
\>    
  "$\llangle$a$\rrangle$ = norm (to\_carrier a)"\\
 {\bf definition} gyroinner :: "'a $\Rightarrow$ 'a $\Rightarrow$ real" (infixl "$\cdot$" 100) {\bf where}\\
\>    
"a $\cdot$ b = inner (to\_carrier a) (to\_carrier b)"\\
{\bf definition} norms :: "real set" {\bf where} \\
\> "norms = \{x. $\exists$ a. x = $\llangle$a$\rrangle$\} $\cup$ \{x. $\exists$ a. x = -$\llangle$a$\rrangle$\}"\\
  {\bf end}
\end{tabbing}
}
\end{small}

In a very similar manner we formalize embedding of $\lVert G\rVert$
(defined as \texttt{norms} in the previous locale) into $G$.  We
require that exist a function $\mathit{of\_real}$ that converts some
real numbers (norms of gyrovectors) to elements of $G$ (gyrovectors).
We also assume that $\mathit{to\_real}$ is its inverse function (on
its codomain).

When giving concrete interpretations of gyrovector spaces, user must
supply all embedding functions. For example, in Section
\ref{sec:mobiuseinstein} we shall see that $G$ can be the abstract set
of points in the Poincar\'e disc, $V$ is the set of complex numbers
(it is a real inner product vector space) -- the Poincar\'e disc is
identified by complex numbers that have norm less than 1.  The
function $\mathit{to\_carrier}$ maps a point in the Poincar\'e disc to
its representing complex number, and $\mathit{of\_carrier}$ is its
inverse (on the complex unit disc). The function $\mathit{of\_real}$
uses the natural embedding of real into complex numbers (it maps the
set $\lVert G\rVert$, which is in this case the open interval
$(-1, 1)$ first to complex numbers and then to points in the
Poincar\'e disc).

\begin{small}
{\tt
\begin{tabbing}
  \hspace{5mm}\=\hspace{5mm}\=\kill
{\bf locale} gyrocarrier'' = gyrocarrier' +\\
\>  {\bf fixes} of\_real :: "real $\Rightarrow$ 'a"\\
\>  {\bf fixes} to\_real :: "'a $\Rightarrow$ real"\\
\>  {\bf assumes} to\_real: "$\bigwedge$ x. x $\in$ norms $\Longrightarrow$ to\_real (of\_real x) = x"
\end{tabbing}
}
\end{small}

Next we introduce the assumption that the inner product must be
invariant under gyrations.

\begin{small}
{\tt
\begin{tabbing}
  \hspace{5mm}\=\hspace{5mm}\=\kill
{\bf class} gyrocarrier = gyrocarrier'' +  \\
\> {\bf assumes} inner\_gyroauto\_invariant: \\
\>\>"$\bigwedge$ u v a b. (gyr u v a) $\cdot$ (gyr u v b) = a $\cdot$ b"
\end{tabbing}
}
\end{small}

Finally, we define gyrovector spaces as gyrocarriers that include the
gyro scalar multiplication $\otimes$ and satisfy the given gyrovector
space axioms.

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\hspace{5mm}\=\kill
{\bf locale} gyrovector\_space = gyrocarrier +\\
\> {\bf fixes} scale ::  "real $\Rightarrow$ 'a $\Rightarrow$ 'a" (infixl "$\otimes$" 105)\\ 
\> {\bf assumes} scale\_1: "$\bigwedge$ a. 1 $\otimes$ a = a"\\
\> {\bf assumes} scale\_distrib:\\ \tab \tab "$\bigwedge$ r1 r2 a. (r1 + r2) $\otimes$ a = r1 $\otimes$ a $\oplus$ r2 $\otimes$ a"\\
\> {\bf assumes} scale\_assoc: "$\bigwedge$ r1 r2 a. (r1 * r2) $\otimes$ a = r1 $\otimes$ (r2 $\otimes$ a)"\\
\> {\bf assumes} scale\_prop1: "$\bigwedge$ r a. r $\neq$ 0 $\Longrightarrow$\\
\>\> to\_carrier (|r| $\otimes$ a) $/_R$ $\llangle$r $\otimes$ a$\rrangle$ = to\_carrier a $/_R$ $\llangle$a$\rrangle$"\\
\> {\bf assumes} gyroauto\_property: \\ \tab \tab "$\bigwedge$ u v r a. gyr u v (r $\otimes$ a) = r $\otimes$ (gyr u v a)"\\
\> {\bf assumes} gyroauto\_id: "$\bigwedge$ r1 r2 v. gyr (r1 $\otimes$ v) (r2 $\otimes$ v) = id"\\
\> {\bf assumes} homogeneity: \\ \tab \tab"$\bigwedge$ r a.  $\llangle$r $\otimes$ a$\rrangle$ =  to\_real ((abs r) $\otimes$ (of\_real $\llangle$a$\rrangle$))"\\
\> {\bf assumes} gyrotriangle: \\ \tab \tab "$\bigwedge$ a b. $\llangle$a $\oplus$ b$\rrangle$ $\leq$ to\_real (of\_real $\llangle$a$\rrangle$) $\oplus$ (of\_real $\llangle$b$\rrangle$)"\\
\end{tabbing}
}
\end{small}

In this abstract setup we proved a large number of lemmas and theorems
that hold in gyrovector spaces (given in Chapter 8 in
\cite{ungar-analytic}).

\subsection{Basic geometric notions}\label{sec:basic_geometry}

The structure of gyrovector spaces is rich enough to allow defining
basic geometric notions. For $x \neq y$ it hold that $z$ belongs to
the line determined by $x$ and $y$ iff there exists a real number $t$
such that $x = y \oplus t \otimes (\ominus y \oplus z)$ (which is
fully analogous to the Euclidean case $x = y + t (z - y)$). This
allows to introduce the definition of collinearity (note that we also
include a degenerate case where $x=y$).

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\hspace{5mm}\=\kill
{\bf definition} collinear :: "'a $\Rightarrow$ 'a $\Rightarrow$ 'a $\Rightarrow$ bool" {\bf where}\\
\>"collinear x y z $\longleftrightarrow$ (y = z $\vee$ ($\exists$ t::real. (x = y $\oplus$ t $\otimes$ ($\ominus$ y $\oplus$ z))))"
\end{tabbing}
}
\end{small}

Collinearity enables the definition of lines.

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\hspace{5mm}\=\kill
{\bf definition} gyroline :: "'a $\Rightarrow$ 'a $\Rightarrow$ 'a set" {\bf where}\\
\>  "gyroline a b = \{x. collinear x a b\}"
\end{tabbing}
}
\end{small}


Definition of the betweenness relation is quite similar (and again
analogous to the Euclidean case).

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\hspace{5mm}\=\kill
{\bf definition} between :: "'a $\Rightarrow$ 'a $\Rightarrow$ 'a $\Rightarrow$ bool" {\bf where}\\
\>  "between x y z $\longleftrightarrow$\\
\>\>($\exists$ t::real. 0 $\leq$ t $\wedge$ t $\leq$ 1 $\wedge$ y = x $\oplus$ t $\otimes$ ($\ominus$ x $\oplus$ z))"
\end{tabbing}
}
\end{small}

Gyro-distance between two points is defined as the norm of their
difference (again analogously to the Euclidean case).

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\hspace{5mm}\=\kill
{\bf definition} distance :: "'a $\Rightarrow$ 'a $\Rightarrow$ real" {\bf where}\\
\>  "distance u v = $\llangle \ominus$ u $\oplus$ v$\rrangle$"
\end{tabbing}
}
\end{small}

It is very easy to prove basic properties of these notions.  For
example, one very important property is that all these properties are
invariant under isometries. We define translation that maps a given
point $a$ to the origin, and prove that it preserves basic geometric
notions (proofs of these are very simple and fully automated, using
previously proven lemmas about gyrovector spaces).


\begin{small}
{\tt
\begin{tabbing}
  \hspace{5mm}\=\hspace{5mm}\=\kill
{\bf definition} translate :: "'a $\Rightarrow$ a $\Rightarrow$ a" {\bf where}\\
\>  "translate a x = $\ominus$ a $\oplus$ x"\\
{\bf lemma} collinear\_translate:\\
\>  {\bf shows} "collinear u v w $\longleftrightarrow$\\
\>\> collinear (translate a u) (translate a v) (translate a w)"\\
{\bf lemma} between\_translate:\\
\>  {\bf shows} "between u v w $\longleftrightarrow$\\
\>\> between (translate a u) (translate a v) (translate a w)"\\
{\bf lemma} distance\_translate:\\
\>  {\bf shows} "distance u v = distance (translate a u) (translate a v)"
\end{tabbing}
}
\end{small}

As an illustration, we give an informal proof that translations
preserve collinearity (in Isabelle/HOL this is proved by automated
provers).

\begin{theorem}
  Let $t_a$ be a translation $t_a(x) = \ominus a \oplus x$. Three
  points $x$, $u$ and $v$ are collinear iff $t_a(x)$, $t_a(u)$ and
  $t_a(v)$ are collinear.
\end{theorem}
\begin{proof} Points $x$, $u$ and $v$ are gyrocollinear, iff $u=v$ or
  there exists a real number $t$ such that
  $x=u\oplus t\otimes (\ominus u \oplus v)$. We can prove that this
  formula is equivalent to $\ominus a \oplus u = \ominus v$ or there
  exists a real number $t$ such that
  $$(\ominus a \oplus x) = (\ominus a \oplus u) \oplus t \otimes
  (\ominus (\ominus a \oplus u) \oplus (\ominus a \oplus v)).$$
  Indeed, if $x=u\oplus t\otimes (\ominus u \oplus v)$, then
\begin{align*} 
(\ominus a \oplus x) &=  \ominus a \oplus (u\oplus t \otimes (\ominus u \oplus v)) \\ 
 &=  (\ominus a \oplus u) \oplus gyr [\ominus a, u] (t\otimes (\ominus u \oplus v))\\
 &= (\ominus a \oplus u) \oplus t \otimes gyr [\ominus a, u] (\ominus u \oplus v)\\
 &= (\ominus a \oplus u) \oplus t \otimes (\ominus (\ominus a \oplus u) \oplus (\ominus a \oplus v))
\end{align*}

We used gyroassociativity, gyroautomorphism property and the
gyrotranslation theorem that states that for $a$, $b$ and $c$, it
holds that
$\ominus (a \oplus b) \oplus (a \oplus c) = gyr[a, b] (\ominus b
\oplus c)$ (Theorem 3.13 in \cite{ungar-analytic}, that we formally
proved in Isabelle/HOL).

The other direction is very similar.
\end{proof}


\section{Instances of gyrovector spaces}\label{sec:mobiuseinstein}

So far gyrogroups and gyrovector spaces have been presented as
abstract algebraic structures. In this section we shall describe their
two most important instances: M\"obius gyrovector space coming from
the realm of hyperbolic geometry and Einstein gyrovector space coming
from the realm of relativistic physics. In order to define these
spaces we must define the operations $\oplus$ and $\otimes$.


\subsection{M\"obius gyrogroup}\label{sec:mobiusgyrogroup}

M\"obius gyrovector space comes from the Poincar\'e disc model of
hyperbolic geometry. In \cite{amai-poincare} it was formally proved
that all direct isometries of the Poincar\'e disc (given in the
complex plane) are of the form:

$$z \mapsto e^{i\theta} \frac{a+z}{1+\overline{a}z}.$$

This inspires the following definition of addition.

\begin{definition}\textbf{(M\" obius addition in the Poincar\'e disc, Definition 3.125 in \cite{ungar-analytic})}: Let 
  $V_1 = \{z\in \mathbb{C}: \norm{z} < 1\}$ be a unit disc in
  $\mathbb{C}$. M\" obius addition $\oplus_m$ is a binary operation
  defined in $V_1$ as:
  
  $$u\oplus_m v = \frac{u+v}{1+\overline{u}v}$$
\end{definition}

Then $z \mapsto a \oplus_m z$ is a translation of the Poincar\'e disc
that maps $-a$ to zero\footnote{Such translations are sometimes called
  Blaschke factors.}, $z \mapsto e^{i\theta}z$ is a rotation of the
disc for the angle $\theta$ and each direct isometry is a translation
followed by a rotation.

Recall that gyration function is necessary to fix the associativity
and commutativity. Therefore, in the case of M\"obius gyrogroup,
gyration is defined by

$$gyr_m[a, b] z = \frac{a\oplus_m b}{b\oplus_m a}z = \frac{1 + a\overline{b}}{1+\overline{a}b}z.$$

The unit disc in $\mathbb{C}$ (the Poincar\'e disc) equipped with the
M\"obius addition and this gyration forms a gyrocommutative gyrogroup.


Note that M\"obius addition can be naturally generalized from the unit
disc in $\mathbb{C}$ to a unit ball in any finite dimension real inner
product vector space $V$ (all of those are isomorphic to
$\mathbb{R}^n$). However, we did not consider this in our
formalization.

\begin{definition}\textbf{(M\" obius addition in the ball of $V$)}: Let $V$
  be a real inner product vector space, let
  $V_{s} = \{v\in V: \norm{v}<s\}$ be a ball in $V$. M\" obius
  addition $\oplus_m$ is a binary operation defined in $V_s$ as:
  
$$u \oplus_m v = \frac{(1+\frac{2}{s^2}uv+\frac{1}{s^2}\norm{v}^2)u+(1-\frac{1}{s^2}\norm{u}^2)v}{1+\frac{2}{s^2}uv+\frac{1}{s^4}\norm{u}^2\norm{v}^2}$$ 
\end{definition}


\subsubsection{Isabelle/HOL formalization}

In our formalization we first defined the set $\mathbb{P}$ of points
in the Poincar\'e disc as a subtype of complex numbers $\mathbb{C}$.
Therefore we consider real inner product space $V=\mathbb{C}$ and the
gyrogroup domain $G=\mathbb{P}$.\footnote{Note that we introduced the
  notation $\mathbb{P}$ for the same set that is denoted by $V_1$ in
  \cite{ungar-analytic}.}

\begin{small}
{\tt
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf typedef} PoincareDisc = "\{z::complex. cmod z < 1\}"\\
{\bf setup\_lifting} type\_definition\_PoincareDisc
\end{tabbing}
}
\end{small}

This lifting introduces the function \texttt{of\_complex} and
\texttt{to\_complex} that converts between $\mathbb{C}$ and
$\mathbb{P}$.

Then we used the lifting/transfer package to define functions
operating on the Poincar\'e disc $\mathbb{P}$ by first defining them
on the representation type $\mathbb{C}$. For example, inner product
and norm are naturally lifted from $\mathbb{C}$ to the Poincar\'e disc
(and the notation $\cdot$ and $\llangle\_\rrangle$ is introduced).

\begin{small}
{\tt
\begin{tabbing}
  \hspace{5mm}\=\kill
  {\bf lift\_definition} inner\_p ::\\
  \> "PoincareDisc $\Rightarrow$ PoincareDisc $\Rightarrow$ real" (infixl "$\cdot$" 100) {\bf is} inner\\
{\bf lift\_definition} norm\_p :: "PoincareDisc $\Rightarrow$ real"  ("$\llangle$\_$\rrangle$" [100] 101) {\bf is} norm
\end{tabbing}
}
\end{small}

We define the M\"obius addition by the following sequence of
definitions (first we define it on the representation type
$\mathbb{C}$ and then we lift it to the abstract type $\mathbb{P}$ of
points of the Poincar\'e disc).

{\tt
\begin{small}
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf definition} oplus\_m' :: "complex $\Rightarrow$ complex $\Rightarrow$ complex" {\bf where}\\
\tab "oplus\_m' u v = (u + v) / (1 + (cnj u)*v)"\\

{\bf lift\_definition} oplus\_m:: "PoincareDisc $\Rightarrow$ PoincareDisc $\Rightarrow$ PoincareDisc" \\
\tab (infixl "$\oplus_m$" 100) {\bf is} oplus\_m'
\end{tabbing}
\end{small}
}

Note that this definition must be followed by a proof that the result
of the defined function always belongs to the unit disc if its
arguments are in the unit disc.

{\tt
\begin{small}
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf lemma} oplus\_m'\_in\_disc:\\
\>  {\bf fixes} u v :: complex\\
\>  {\bf assumes} "cmod u < 1" "cmod v < 1"\\
\>  {\bf shows} "cmod (oplus\_m' u v) < 1"
\end{tabbing}
\end{small}
}

\noindent The proof of this lemma is not trivial, but is quite
technical and non-interesting. Note that such proofs are usually
missing from the literature (they are not even mentioned in
\cite{ungar-analytic}), but the process of formalization reveals all
the properties that must be proved in order to have a fully formalized
theory.

We formalize the gyration by the next sequence of definitions.

{\tt
\begin{small}
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf definition} gyr\_m' :: "complex $\Rightarrow$ complex $\Rightarrow$ complex $\Rightarrow$ complex" {\bf where}\\
\>  "gyr\_m' a b z = ((1 + a * cnj b) / (1 + cnj a * b)) * z"\\
{\bf lift\_definition} gyr$_m$ ::\\
\>"PoincareDisc $\Rightarrow$ PoincareDisc $\Rightarrow$ PoincareDisc $\Rightarrow$ PoincareDisc" is gyr\_m'
\end{tabbing}
\end{small}
}

For this definition to be valid, it must be proved that the result of
gyration is in the unit disc if all its areguments are in the unit
disc (which is easy, since $|1+a\overline{b}| = |1+\overline{a}b|$).

{\tt
\begin{small}
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf lemma} gyr\_m'\_in\_disc:\\
\>  {\bf fixes} a b z :: complex\\
\>  {\bf assumes} "cmod a < 1" "cmod b < 1" "cmod z < 1"\\
\>  {\bf shows} "cmod (gyr\_m' a b z) < 1"
\end{tabbing}
\end{small}
}

One of the central results of our formalization is that with such
gyration, $(\mathbb{P}, \oplus_m)$ is a gyrocommutative gyrogroup,
i.e., that $\oplus_m$ satisfies all axioms of gyrogroup and the axiom
of gyrocommutativity (this last proof is very easy, since gyration is
defined so that the gyrcommutativity holds). Again, these proofs are
not present in the literature (at one point Ungar comments ,,this
space turns out to be a gyrocommutative gyrogroup, as one can readily
check by computer algebra''). They are quite technical and indeed
reduce to algebraic manipulations with complex numbers, but, in order
to formalize them we had to make all the computation steps explicit
(the are available in our formalization, but we do not print them in
the paper).

As it is often the case, it turns out that it is usefull to have
alternative definitions of the same notion, so we formalized (and
later used) an alternative definition of M\"obius addition (and, of
course, proved that it is equivalent to the original one).

{\tt
\begin{small}
\begin{tabbing}
\hspace{5mm}\=\hspace{5mm}\=\kill
{\bf definition} oplus\_m'\_alternative :: "complex $\Rightarrow$ complex $\Rightarrow$ complex" {\bf where} \\
\>  "oplus\_m'\_alternative u v =\\
\>\>      ((1 + 2 * inner u v + (norm v)$^2$) $*_R$ u + (1 - (norm u)$^2$) $*_R$ v) / \\
\>\>       (1 + 2 * inner u v + (norm u)$^2$ * (norm v)$^2$)"\\
{\bf lift\_definition} oplus\_m\_alternative ::\\
\> "PoincareDisc $\Rightarrow$ PoincareDisc $\Rightarrow$ PoincareDisc" {\bf is} oplus\_m'\_alternative
\end{tabbing}
\end{small}
}

\subsection{M\"obius gyrovector space}

In \cite{ungar-analytic} Ungar shows that M\" obius gyrogroup
$(V_1, \oplus_m)$ admits scalar multiplication $\otimes_m$, turning it
into the M\" obius gyrovector space $(V_1, \oplus_m, \otimes_m)$.

\begin{definition}\textbf{(M\" obius Scalar Multiplication)}: Let
  $(V_1, \oplus_m)$ be a M\" obius gyrogroup. For $r \in \mathbb{R}$,
  $v \in V_1$, and $v \neq 0$, the M\" obius scalar multiplication
  $r\otimes_{m} v$ is in $V_1$ and is given by the equation:

  \begin{equation}
   \label{eq:otimes}
    r\otimes_{m} v = \frac{(1+\norm{v})^r - (1-\norm{v})^r}{(1+\norm{v})^r + (1-\norm{v})^r}\cdot\frac{v}{\norm{v}}.
  \end{equation}
  

  \noindent For $v=0$, it holds that $r\otimes_{m} 0 = 0$.
\end{definition}

This formula is derived by generalizing the expressions for
$2\otimes v = v \oplus v$, $3\otimes v = v \oplus v \oplus v$ etc.

\subsubsection{Isabelle/HOL formalization}

As expected, first we define our $\otimes_m$ operation on complex
numbers and then we lift this definition to the Poincar\'e
disc.\footnote{In section \ref{einstein_gvs} we shall see that the
  definition of scalar multiplication is exactly the same in the
  Einstein gyrovector space, so we denote this operation, by
  $\otimes_m$, $\otimes_e$ and by $\otimes_{me}$, depending on the
  context.}

{\tt
\begin{small}
\begin{tabbing}
{\bf definition}  otimes\_me'\_k  :: "real $\Rightarrow$ complex $\Rightarrow$ real" {\bf where}\\
\tab "otimes\_me'\_k r z = \=((1 + cmod z) powr r - (1 - cmod z) powr r) /\\
\>                  ((1 + cmod z) powr r + (1 - cmod z) powr r)"\\ 
{\bf definition} otimes\_me' :: "real $\Rightarrow$ complex $\Rightarrow$ complex" {\bf where}\\
\tab "otimes\_me' r z = (if z = 0 then 0 else otimes\_me'\_k r z * (z / cmod z)"\\
{\bf lift\_definition} otimes\_me :: "PoincareDisc $\Rightarrow$ PoincareDisc $\Rightarrow$ PoincareDisc" \\
\tab (infixl "$\otimes_{me}$" 105) {\bf is} me\_otimes'
\end{tabbing}
\end{small}
}

We did not find an explicit proof that
$(\mathbb{P}, \oplus_m, \otimes_{me})$ is a gyrovector space in the
literature (only some fragments were presented in the
books\cite{ungar-analytic}). So, another contribution of our
formalization is that this proof is given explicitly (and
additionally, its correctness is machine checked).

Very important characterization of $\otimes_{me}$ uses hyperbolic
trigonometric functions (instead of power function used in the
original definition).

{\tt
\begin{small}
\begin{tabbing}
\hspace{5mm}\=\kill
{\bf lemma} otimes\_me'\_k\_tanh:\\
\>  {\bf fixes} r :: real {\bf and} z :: complex\\
\>  {\bf assumes} "cmod z < 1"\\
\>  {\bf shows} "otimes\_me'\_k r z = tanh (r * artanh (cmod z))"
\end{tabbing}
\end{small}
}


Our proof would be much harder (or almost impossible) if we didn't use
the Lorentz factor, a crucial concept in the theory of relativity,
named after the Dutch physicist Hendrik Lorentz. It describes how
time, length, and relativistic mass change for an object moving
relative to an observer. The Lorentz factor $\gamma_u$ is given by the
equation:

$$\gamma_u = \frac{1}{\sqrt{1-\frac{\norm{u}^2}{c^2}}}$$

\noindent where $c$ is the speed of the light in vacuum.

A special property of Lorentz factor is that Lorentz factor is complex
if the norm of $u$ is bigger than $1$ and real if the norm is smaller
than $1$ and vice versa. However, we could not use this in
Isabelle/HOL since functions which define power (\texttt{sqrt},
\texttt{pow}, etc.)  are always real valued.

We defined the Lorentz $\gamma$-factor in the following way (assuming
without loss of generality that $c=1$):


{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf definition} gamma\_factor :: "complex $\Rightarrow$ real" ("$\gamma$") {\bf where}\\
\> "gamma\_factor u = \\
\>\> (if (norm u)$^2$ < 1 then  1 / sqrt (1 - (norm u)$^2$) else 0)"\\
{\bf lift\_definition} gammma\_factor\_p :: "PoincareDisc $\Rightarrow$ real" ("$\gamma_p$") {\bf is}\\
\> gamma\_factor
\end{tabbing}
\end{small}
\tt}


Most gyrovector space axioms were non-trivial, but rather
straightforward to prove, but there were exceptions. The hardest axiom
to prove was the gyrotriangle inequality. We needed to prove that
$\norm{a\oplus_m b} \leq \norm{a} \oplus_m \norm{b}$ and we did that
using Lorentz factors and their properties.

First we proved a lemma that claims that $\gamma$-factor is a
monotonically increasing function on the iterval $[0, 1)$ and so its
inverse function.

{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf lemma} gamma\_factor\_increase\_reverse:\\
\>  {\bf fixes} t1 t2 :: real\\
\>  {\bf assumes} "0 $\leq$ t1" "t1 < 1" "0 $\leq$ t2" "t2 < 1"\\
\>  {\bf assumes} "$\gamma$ t1 > $\gamma$ t2"\\
\>  {\bf shows} "t1 > t2"
\end{tabbing}
\end{small}
}

After that we have proved the following lemma that expresses the
$\gamma$-factor of the norm of the M\"obius sum of two points in terms
of their $\gamma$-factors.

{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf lemma} gamma\_factor\_norm\_oplus\_m:\\
\>  {\bf fixes} a b :: PoincareDisc\\
\>  {\bf shows} "\=$\gamma$ $\llangle$a $\oplus_m$ b$\rrangle$ =\\
\>\>$\gamma_p$ a * $\gamma_p$ b * cmod (1 + cnj (to\_complex a) * (to\_complex b))"
\end{tabbing}
\end{small}
}

From this, we could prove the triangle inequallity for the
$\gamma$-factors.

{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf lemma} gamma\_factor\_oplus\_m\_triangle\_inequality:\\
\>  {\bf fixes} a b :: PoincareDisc\\
\>  {\bf shows} "$\gamma$ $\llangle$a $\oplus_m$ b$\rrangle$ $\leq$ $\gamma_p$ ((of\_complex $\llangle a\rrangle$) $\oplus_m$ (of\_complex $\llangle$b$\rrangle$))"
\end{tabbing}
\end{small}
}

\noindent The triangle inequality holds from this by the monotonicity
of the inverse $\gamma$-factor.

Proof of these and other related lemmas are available in our
formalization. They are non-trivial and rely on algebraic
manipulations of expressions (equalities and inequalities) over
complex numbers.

\subsection{Einstein gyrogroup and gyrovector space}
\label{einstein_gvs}
  
According to the Einstein's theory of relativity, as an object's speed
approaches the speed of light, its relativistic mass increases towards
infinity, requiring infinite energy to accelerate further. Therefore,
it is impossible for an object to move at or above the speed of
light. While Newtonian velocities are represented by vectors in
$\mathbb{R}^3$, Einstein velocities are represented by vectors within
a ball of radius $c$ where $c$ is the speed of light. In our
formalization we represented velocities by points of a unit ball
(setting $c=1$) in 2d space (unit disc). Most of the theorems that we
formally proved in this special case can be easily generalized to
higher dimensions and different values of the constant $c$ (the speed
of light, i.e., the radius of the admissible velocity ball).

In classic Newtownian physics, velocities are combined by the vector
addition in an ordinary vector space. Einstein's addition law, which
describes how velocities combine in special relativity, leads to rich
nonassociative algebraic structures --- gyrovector spaces. We formally
define Einstein's velocity addition law, the corresponding Thomas
gyration, and the Einstein scalar multiplication, and then we proved
that they satisfy the axioms of gyrovector space.

As we shall see, it turns out that the Einstein gyrovector spaces are
isomorphic to the M\" obius gyrovector spaces (described in previous
section), and that relativistic physics is set in hyperbolic
gometry. We formalized this connection between M\" obius and Einstein
gyrovector spaces. As we know, this is the first explicit proof of
this theorem in the literature. It is not hard, but it's tehnically
very challenging and involves many computational tricks.

Let us first define Einstein's velocity addition $\oplus_e$.

\begin{definition}\textbf{(Einstein addition in the ball, Definition 3.39 in \cite{ungar-analytic})}
  \label{def:einsteinaddition}

  Let $V$ be a real inner product vector space and let
  $V_1 = \{v\in V: \norm{v}<1\}$ be a unit ball in $V$. Einstein
  addition $\oplus_e$ is a binary operation defined in $V$ as:
  
  $$u \oplus_e v = \frac{1}{1+u\cdot v}\Big\{u+\frac{1}{\gamma_u}v+\frac{\gamma_u}{1+\gamma_u}(u\cdot v)u\Big\}$$
  
  \noindent where $\gamma_u$ is the Lorentz $\gamma$-factor and
  $\cdot$ and $\norm{\cdot}$ are the inner product and norm that the
  ball $V_1$ inherits from its space $V$.
\end{definition}

Einstein scalar multiplication $\otimes_{e}$ is defined in the same
way as in the M\"obius case (Equation \ref{eq:otimes}).

\subsubsection{Isabelle/HOL formalization}

Einstein addition in $\mathbb{P}$ is formally defined by the following
definitions.

{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf definition} oplus\_e' :: "complex $\Rightarrow$ complex $\Rightarrow$ complex" {\bf where}\\
\>  "oplus\_e' u v = \\
\>\>(1 / (1 + inner u v)) $*_R$\\
\>\>(u + (1 / $\gamma$ u) $*_R$ v + (($\gamma$ u / (1 + $\gamma$ u)) * (inner u v)) $*_R$ u)"\\
{\bf lift\_definition} oplus\_e :: "PoincareDisc $\Rightarrow$ PoincareDisc $\Rightarrow$ PoincareDisc"\\
\> (infixl "$\oplus_e$" 100) is oplus\_e'
\end{tabbing}
\end{small}
}

To lift this definition from complex numbers to Poincar\'e disc, one
must prove that the Poincar\'e disc is closed under this operation.

{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf lemma} oplus\_e'\_in\_unit\_disc:\\
\>  {\bf assumes} "cmod u < 1" "cmod v < 1"\\
\>  {\bf shows} "cmod (oplus\_e' u v) < 1"
\end{tabbing}
\end{small}
}

Given the complexity of the expression in the definition of Einstein
addition, this proof is not trivial. We managed to prove it using
$\gamma$-factors. The following lemma expresses the $\gamma$-factor of
the Einstein sum of two points in terms of their $\gamma$-factors.

\begin{lemma}\label{lemma:gammaeinstein}
  For all points $u$ and $v$ in the unit disc $\mathbb{P}$ it holds:
  $$\gamma_{u\oplus_e v} = \gamma_u\gamma_v(1+u\cdot v)$$
\end{lemma}

\noindent It is formalized as follows (the formalization gives the
statement on the representation type $\mathbb{C}$):

{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf lemma} gamma\_factor\_oplus\_e':\\
\>  {\bf assumes} "cmod u < 1" "cmod v < 1"\\
\>  {\bf shows} "$\gamma$ (oplus\_e' u v) = ($\gamma$ u) * ($\gamma$ v) * (1 + inner u v)"
\end{tabbing}
\end{small}
}

\noindent The proof of this lemma is not hard, but is technically
involved. With this lemma it is not hard to prove that the unit disc
is closed for \texttt{oplus\_e}. Since \texttt{$\gamma$ (oplus\_e' u
  v) = 1 / sqrt(1 - (cmod (oplus\_e' u v))$^2$)}, and
\texttt{($\gamma$ u) * ($\gamma$ v) * (1 + inner u v)} is a positive
real number, so must be \texttt{sqrt(1 - (cmod (oplus\_e' u
  v))$^2$)}. This is possible only if the radicand is non-negative,
implying that \texttt{cmod (oplus\_e' u v)} is less than 1.

Again, details of such proofs are not present in the literature. Ungar
just gives a brief comment: ,,Like M\"obius addition in the ball, one
can show by computer algebra that Einstein addition in the ball is a
gyrocommutative gyrogroup operation''. This would be very challenging
to do in an interactive theorem prover, so we decided to take a
different approach.



\subsection{Gyrovector space isomorphism}

Instead of directly proving that the Einstein space
$(V_1, \oplus_e, \otimes_{e})$ is a gyrovector space, for which we
think would be very technically challenging to do in an interactive
theorem prover, we showed that this structure is isomorphic to
M\"obius gyrovector space $(V_1, \oplus_m, \otimes_{m})$, and
therefore must satisfy axioms of gyrovector space.

We begin with the following definition.

\begin{definition}
  Two gyrovector spaces $(G_1, \oplus_1, \otimes_1)$ and
  $(G_2, \oplus_2, \otimes_2)$ are \emph{isomorphic} if there exists a
  bijective map $\phi: G_1 \rightarrow G_2$ such that the following
  conditions are satisfied:
\begin{itemize}
    \item $\phi(u\oplus_1 v) = \phi(u)\oplus_2 \phi(v)$
    \item $\phi(r\otimes_1 v) = r\otimes_2 \phi(v)$
    \item
      $\frac{\phi(u)}{\parallel \phi(u) \parallel}\cdot
      \frac{\phi(v)}{\parallel \phi(v)\parallel} = \frac{u}{\parallel
        u \parallel}\cdot \frac{v}{\parallel v \parallel}$
\end{itemize}
\end{definition}

Informally, it means that $\phi$ preserves gyrovector space operations
and keeps the inner product of the unit vectors invariant.

This definition proved to be very useful, because if we can formally
prove that some structure is a gyrovector space, and we find an
isomorphism map to another structure, we can easily prove that that
other is also a gyrovector space.

In our formalization we have formally proved that the map
$u \mapsto \frac{1}{2}\otimes_m u$ is an isomorphism that maps
M\"obius gyrovectors to Einstein gyrovectors, and used that to prove
that Einstein gyrovectors satisfy all gyrovectorspace axioms. The
description of this isomorphism is given in \cite{ungar-analytic}, but
as in many other cases the proof is missing. We made a proof and
formalized it in Isabelle/HOL. As a contribution to the literature we
give an informal description of this proof.

First we formulate some simple lemmas.

\begin{lemma}\label{lemma:halfgamma}
  For any point $u \in \mathbb{P}$ it holds:
  $$\frac{1}{2}\otimes_m u = \frac{\gamma_u}{\gamma_u + 1} u$$
\end{lemma}

\begin{lemma}\label{lemma:normhalfsquared}
  For any point $u \in \mathbb{P}$ it holds:
  $$\norm{\frac{\gamma_u}{\gamma_u+1}u}^2 =\frac{\gamma_u^2}{(1+\gamma_u)^2}\cdot\norm{u}^2 = \frac{\gamma_u-1}{\gamma_u+1}$$
\end{lemma}

Our central theorem proves that the isomorphism
$u \mapsto \frac{1}{2}\otimes_m u$ connects M\"obius and Einstein
addition (other two properites are much easier to prove).

\begin{theorem}
  Let $G_e=(V_c, \oplus_e, \otimes_e)$ and
  $G_m=(V_c, \oplus_m, \otimes_m)$ be respectively, the Einstein and
  the Mobius gyrovector spaces of the same ball $V_c$ of a same real
  inner product space $V$.  The following formulas are correct:
  
  $$\frac{1}{2}\otimes_e (u\oplus_e v) = (\frac{1}{2}\otimes_m u) \oplus_m (\frac{1}{2} \otimes_m v)$$
\end{theorem}
\begin{proof}
  By Lemma \ref{lemma:halfgamma} it holds that

  $$(\frac{1}{2}\otimes_m u) \oplus_m (\frac{1}{2} \otimes_m v) = (\frac{\gamma_u}{\gamma_u + 1} u) \oplus_m (\frac{\gamma_v}{\gamma_v + 1} v)$$

  It turns out that it is better to apply the alternative definition
  of M\"obius addition (described in Section
  \ref{sec:mobiusgyrogroup}). Then we get that the right hand side is
  equal to:

$$
  \frac{\Big(1 + 2\cdot\frac{\gamma_u}{\gamma_u+1}\cdot\frac{\gamma_v}{\gamma_v+1}(u\cdot v) + \norm{\frac{\gamma_v}{\gamma_v+1}v}^2\Big) \cdot \frac{\gamma_u}{\gamma_u + 1} u\, + \Big(1-\norm{\frac{\gamma_u}{\gamma_u+1}}^2\Big)\cdot \frac{\gamma_v}{\gamma_v+1}v}
  {1+2\frac{\gamma_u}{\gamma_u+1}u \cdot \frac{\gamma_v}{\gamma_v+1}v + \norm{\frac{\gamma_u}{\gamma_u+1}u}^2 \cdot \norm{\frac{\gamma_v}{\gamma_v+1}v}^2}
$$

By applying Lemma \ref{lemma:normhalfsquared}, the expression
transforms into:

$$\frac
{\Big(1+\frac{2\gamma_u\gamma_v}{(\gamma_u+1)(\gamma_v+1)}(u\cdot v) + \frac{\gamma_v -1}{\gamma_v+1}\Big)\cdot \frac{\gamma_u}{\gamma_u+1}u + \Big(1-\frac{\gamma_u-1}{\gamma_u+1}\Big)\cdot \frac{\gamma_v}{\gamma_v+1}v}
{1 + \frac{2\gamma_u\gamma_v}{(\gamma_u+1)(\gamma_v+1)}(u\cdot v)+\frac{\gamma_u-1}{\gamma_u+1}\cdot\frac{\gamma_v-1}{\gamma_v+1}}$$

We simplify our expression more using the following equations:

\begin{footnotesize}
\begin{eqnarray*}
  1+\frac{\gamma_v-1}{\gamma_v+1}=\frac{2\gamma_v}{\gamma_v+1}, \qquad 1-\frac{\gamma_u-1}{\gamma_u+1}=\frac{2}{\gamma_u+1}\\
  1+\frac{\gamma_u-1}{\gamma_u+1}\cdot \frac{\gamma_v-1}{\gamma_v+1}= \frac{2(1+\gamma_u\gamma_v)}{(1+\gamma_u)(1+\gamma_v)}
\end{eqnarray*}
\end{footnotesize}

and we get:

$$\frac
{\Big( \frac{2\gamma_v}{1+\gamma_v}+\frac{2\gamma_u\gamma_v}{(1+\gamma_u)(1+\gamma_v)}(u\cdot v)\Big)\cdot\frac{\gamma_u}{1+\gamma_u}u + \frac{2}{1+\gamma_u}\cdot\frac{\gamma_v}{1+\gamma_v}v}
{\frac{2\gamma_u\gamma_v}{(\gamma_u+1)(\gamma_v+1)}(u\cdot v) + \frac{2(1+\gamma_u\gamma_v)}{(1+\gamma_u)(1+\gamma_v)}}
$$

Adding fractions after reducing them to their common denominator, and
cancelling $(1+\gamma_u)(1+\gamma_v)$ (that is not zero) gives:

$$
\frac{2\gamma_u\gamma_v\Big(u+\frac{1}{\gamma_u}v+\frac{\gamma_u}{1+\gamma_u}(u \cdot v)u\Big)}{2\gamma_u\gamma_v(1+u\cdot v) + 2} = \frac{\gamma_u\gamma_v\Big(u+\frac{1}{\gamma_u}v+\frac{\gamma_u}{1+\gamma_u}(u \cdot v)u\Big)}{\gamma_u\gamma_v(1+u\cdot v) + 1}
$$

On the other hand, from Lemma \ref{lemma:halfgamma} it holds that:

$$\frac{1}{2}\otimes_e (u \otimes_e v) = \frac{\gamma_{u \otimes_e
    v}}{\gamma_{u \otimes_e v} + 1}(u \otimes_e v).$$

From Lemma \ref{lemma:gammaeinstein} and Definition
\ref{def:einsteinaddition} of Einstein addition, we can conclude that:

$$\frac{1}{2}\otimes_e (u \otimes_e v) = \frac{\gamma_u \gamma_v (1+u\cdot v)}{\gamma_u \gamma_v (1+u\cdot v) + 1}\Big\{\frac{1}{1+u\cdot v}\Big( u +\frac{1}{\gamma_u}v + \frac{\gamma_u}{\gamma_u + 1}(u\cdot v)\cdot u \Big)\Big\}$$

Cancelling $1 + u\cdot v$ (that is not zero), and putting the two
sides together, we see that the theorem holds.
\end{proof}

Formal statement of this theorem is quite direct.

{\tt
\begin{small}
\begin{tabbing}
\tab\=\tab\=\kill
{\bf theorem} iso\_me\_oplus:\\
\>  {\bf shows} "(1/2) $\otimes_{me}$ (u $\oplus_e$ v) = ((1/2) $\otimes_{me}$ u) $\oplus_m$ ((1/2) $\otimes_{me}$ v)"
\end{tabbing}
\end{small}
}

\noindent Its formal proof directly follows the informal one,
carefully checking every step of computation and simplification.

The previous result enables expressing Einstein addition in terms of
M\"obius addition an scalar multiplication, which are operations whose
properties are by now formally analyzed.

{\tt
\begin{small}
\begin{tabbing}
  \tab\=\tab\=\kill
{\bf lemma} oplus\_e\_oplus\_m:\\
\> {\bf  shows} "u $\oplus_e$ v = 2 $\otimes_{me}$ (((1/2) $\otimes_{me}$ u) $\oplus_m$ (1/2) $\otimes_{me}$ v)"
\end{tabbing}
\end{small}
}


Since many axioms use gyrations we needed to prove that the
isomorphism map $u \mapsto (1/2)\otimes_m u$ preserves gyrations,
which enables expressing Einstein gyration via M\"obius gyration.

{\tt
\begin{small}
  \begin{tabbing}
\tab\=\tab\=\kill
{\bf lemma} iso\_me\_gyr:\\
\> {\bf shows} "\=(1/2) $\otimes_{me}$ gyr$_e$ a b z =\\
\>\>gyr$_m$ ((1/2) $\otimes_{me}$ a) ((1/2) $\otimes_E$ b) ((1/2) $\otimes_{me}$ z)"\\
{\bf lemma} gyr\_e\_gyr\_m:\\
\> {\bf shows} "\= gyr$_e$ a b z =\\
\>\>2 $\otimes_{me}$ (gyr$_m$ ((1/2) $\otimes_{me}$ a) ((1/2) $\otimes_E$ b) ((1/2) $\otimes_{me}$ z))"
\end{tabbing}
\end{small}
}


From these connections it is very easy to prove that Einstein addition
and gyration form a gyrocommutative gyrogroup (without unfolding the
definition of $\oplus_E$ dealing with lots of hard calculations).
Here is an example of one such simple and readable proof (in Isar
language). The lemma proves that Einstein addition is gyroassociative.

{\tt
\begin{small}
\begin{tabbing}
  \hspace{3mm}\=\hspace{3mm}\=\hspace{3mm}\=\hspace{3mm}\=\kill
{\bf lemma} oplus\_e\_gyro\_left\_assoc:\\
\>  {\bf shows} "a $\oplus_e$ (b $\oplus_e$ z) = (a $\oplus_e$ b) $\oplus_e$ gyr$_e$ a b z"\\
{\bf proof}-\\
\>  {\bf let} ?a = "(1/2) $\otimes_{me}$ a" {\bf and} ?b = "(1/2) $\otimes_{me}$ b" {\bf and} ?z = "(1/2) $\otimes_{me}$ z"\\
\>  {\bf have} "a $\oplus_e$ (b $\oplus_e$ z) = 2 $\otimes_{me}$ (?a $\oplus_m$ (?b $\oplus_m$ ?z))"\\
\>\>    {\bf using} iso\_me\_oplus oplus\_e\_oplus\_m {\bf by} simp\\
\>  {\bf also} {\bf have} "$\ldots$ = 2 $\otimes_{me}$ ((?a $\oplus_m$ ?b) $\oplus_m$ m\_gyr ?a ?b ?z)"\\
\>\>    {\bf using} oplus\_m\_gyro\_left\_assoc {\bf by} simp\\
\>  {\bf also} {\bf have} "$\ldots$ = 2 $\otimes_{me}$ (((1/2) $\otimes_{me}$ (a $\oplus_e$ b)) $\oplus_m$ m\_gyr ?a ?b ?z)"\\
\>\>    {\bf using} iso\_me\_oplus {\bf by} simp\\
\>  {\bf also} {\bf have} "$\ldots$ = 2 $\otimes_{me}$ (((1/2) $\otimes_{me}$ (a $\oplus_e$ b)) $\oplus_m$ (1/2) $\otimes_{me}$ e\_gyr a b z)"\\
\>\>    {\bf using} gyr\_e\_gyr\_m {\bf by} simp\\
\>  {\bf finally} {\bf show} ?thesis\\
\>\>    {\bf using} oplus\_e\_oplus\_m {\bf by} simp\\
{\bf qed}
\end{tabbing}
\end{small}
}

Isabelle/HOL automation is powerfull enough to find this proof fully
automatically.

{\tt
\begin{small}
\begin{tabbing}
  \hspace{2mm}\=\hspace{3mm}\=\hspace{3mm}\=\hspace{3mm}\=\kill
{\bf lemma} e\_gyro\_left\_assoc:\\
\>  {\bf shows} "a $\oplus_e$ (b $\oplus_e$ z) = (a $\oplus_e$ b) $\oplus_e$ e\_gyr a b z"\\
{\bf using} gyr\_e\_gyr\_m oplus\_e\_oplus\_m iso\_me\_oplus oplus\_m\_gyro\_left\_assoc\\
{\bf by} simp
\end{tabbing}
\end{small}
}

To prove gyrovector space axioms, some additional work needs to be
done. We proved the connection of the isomorphism function
$z \mapsto (1/2) \otimes z$ and its inverse $z \mapsto 2 \otimes z$
with the inner product and the norm. This is then used to prove the
invariance of the inner product under gyrations and the triangle
inequality. Since these explicit proofs are missing from
\cite{ungar-analytic}, as a contribution to the literature we shall
present an informal proof sketches (the full formal proofs are
available in our formalization).

\begin{lemma}\label{lemma:iso_dot}
  For all elements $a$ and $b$ in the unit disc $\mathbb{P}$ it holds

  $$((1/2)\otimes a)\cdot b = \frac{\gamma_a}{1 + \gamma_a}(a\cdot b), \qquad a \cdot ((1/2)\otimes b) = \frac{\gamma_b}{1 + \gamma_b}(a\cdot b).$$

  $$(2\otimes a)\cdot b = \frac{2\gamma^2_a}{2\gamma^2_a-1}(a\cdot b), \qquad a \cdot (2\otimes b) = \frac{2\gamma^2_b}{2\gamma^2_b-1}(a\cdot b).$$
\end{lemma}

This is easily proved by direct computation. By expressing norm as
$(\llangle a \rrangle)^2 = a \cdot a$, expressions for
$\llangle (1/2)\otimes a\rrangle$ and $\llangle 2\otimes a\rrangle$
directly follow.

\begin{theorem}
  For any three points $u, v, a \in \mathbb{P}$ it holds:
  $$gyr_e[u, v] a \cdot gyr_e[u, v] b = a \cdot b.$$
\end{theorem}
\begin{proof}
  Let $u' = (1/2)\otimes u$, $v' = (1/2)\otimes v$,
  $a' = (1/2)\otimes a$ and $b' = (1/2)\otimes b$. By the isomorphism
  property of gyration it holds that
  $$gyr_e[u, v] a \cdot gyr_e[u, v] b  = (2\otimes gyr_m[u', v'] a') \cdot (2\otimes gyr_m[u', v'] b')$$

  By Lemma \ref{lemma:iso_dot} this is further equal to:

  $$\left(\frac{2\gamma_{G_a}}{2\gamma{G_a}-1}\right)\left(\frac{2\gamma_{G_b}}{2\gamma{G_b}-1}\right)(G_a \cdot G_b),$$

  \noindent where $G_a = gyr_m[u', v'] a'$ and
  $G_b = gyr_m[u', v'] b'$. Since inner product is invariant under
  M\"obius gyrations this is equal to:

  $$\left(\frac{2\gamma_{G_a}}{2\gamma{G_a}-1}\right)\left(\frac{2\gamma_{G_b}}{2\gamma{G_b}-1}\right)(a' \cdot b').$$

  By Lemma \ref{lemma:iso_dot} this is further equal to:

  $$\left(\frac{2\gamma_{G_a}}{2\gamma{G_a}-1}\right)\left(\frac{2\gamma_{G_b}}{2\gamma{G_b}-1}\right)\left(\frac{\gamma_a}{1+\gamma_a}\right)\left(\frac{\gamma_b}{1+\gamma_b}\right)(a \cdot b).$$

  The proof finishes by tedious but straightforward proof that

  $$\left(\frac{2\gamma_{G_a}}{2\gamma{G_a}-1}\right)\left(\frac{\gamma_a}{1+\gamma_a}\right) = \left(\frac{2\gamma_{G_a}}{2\gamma{G_a}-1}\right)\left(\frac{\gamma_a}{1+\gamma_a}\right) = 1$$
\end{proof}


We based the proof of the gyrotriangle equality for $\oplus_e$ on the
monotonicity of the function $x \mapsto \tanh (2 \atanh(x))$ on the
interval $[0, 1)$ and the following lemma.


\begin{lemma}\label{lemma:norm_scale}
  For $r \in R$ and $a \in \mathbb{P}$ it holds

  $$\llangle r\otimes a \rrangle = \lvert \tanh (r \atanh(\llangle a\rrangle)\rvert$$
\end{lemma}

\noindent For $r > 0$ (including $r=2$) there is no need for absolute value on the right hand side.

\begin{theorem}
  For any $a, b \in \mathbb{P}$ it holds:
  
  $$\llangle a \oplus_e b\rrangle \leq \llangle \llangle a\rrangle \oplus_e \llangle b\rrangle \rrangle$$

  By the isomorphism properties left hand side is equal to:

  $$\llangle 2 \otimes (((1/2)\otimes a) \oplus_m ((1/2)\otimes b))\rrangle)$$

  The right hand side is equal to:

  $$\llangle 2\otimes (\llangle (1/2)\otimes a\rrangle \oplus_m \llangle (1/2)\otimes b\rrangle)\rrangle$$

  The theorem then follows by the gyroriangle inequallity for M\"obius
  addition applied on $(1/2)\otimes a$ and $(1/2)\otimes b$, Lemma
  \ref{lemma:norm_scale} and the monotonicity of the function
  $x \mapsto \tanh (2 \atanh(x))$ on the interval $[0, 1)$.
\end{theorem}

Other gyrovector axioms directly follow from the isomorphism
properties and were very easy to prove.

\section{Modelling hyperbolic geometry}\label{sec:models}

We have shown that M\"obius and Einstein addition, along with gyration
and scaling, give rise to gyrovector space structures. In this
section, we will demonstrate that these structures correspond
precisely to well-known models of hyperbolic geometry. Specifically,
we will formally show that the M\"obius gyrovector space is
essentially equivalent to the Poincar\'e disc model (formally
described in \cite{amai-poincare}). Since Einstein velocity addition
is isomorphic to M\"obius addition (as we formally established in the
previous section), this implies that relativistic physics is grounded
in hyperbolic geometry. It can also be shown that the Einstein
gyrovector space is essentially equivalent to the Klein-Beltrami model
of hyperbolic geometry (formally described in
\cite{makarios,harrison2005hol,coghetto2018klein}).

To demonstrate that the M\"obius gyrovector space is a valid model of
hyperbolic geometry, we must show that it satisfies all axioms of
absolute geometry and the negation of the parallel postulate. These
axioms can be taken, for example, as Tarski's axioms \cite{tarski}. In
\cite{amai-poincare}, it was proven that the Poincar\'e disc, defined
using homogeneous coordinates in projective space $\mathbb{C}P^1$,
satisfies these axioms. Instead of directly proving that M\"obius
gyrovector space concepts (such as points, collinearity, betweenness,
distance, and congruence) satisfy Tarski's axioms, we have shown that
they are equivalent to the corresponding concepts in the Poincar\'e
disc model. Consequently, we know that they must satisfy all the
axioms, and additionally, we know that the M\"obius gyrovector space
is fundamentally the same as the Poincar\'e disc model.

In \cite{amai-poincare}, h-points in the Poincar\'e disc were defined
as a subtype of $\mathbb{C}P^1$ with norm less than 1. Points in
$\mathbb{C}P^1$ are represented by pairs of complex numbers (their
homogeneous coordinates). Since all points within the Poincar\'e disc
are finite (note that $\mathbb{C}P^1$ contains both finite and
infinite points), these points can be identified with the complex
numbers in the unit disc. Thus, we identify the unit disc
$\mathbb{P}'$ set in $\mathbb{C}P^1$ defined in \cite{amai-poincare}
with the unit disc $\mathbb{P}$ set in $\mathbb{C}$ as defined in the
present paper (formally, there exists a natural bijection between the
two abstract types \texttt{PoincareDisc} and \texttt{PoincareDisc'}).

A fundamental aspect of each model of hyperbolic geometry is the
distance function. In \cite{amai-poincare}, it was shown that the
distance between points in $\mathbb{P'}$, represented by the
homogeneous coordinates of complex numbers $u$ and $v$ (with norm less
than 1), can be calculated by:

$$d'(u, v) = \arccosh\left(1 + 2\frac{\lVert u-v \rVert^2}{(1-\lVert u \rVert^2)(1-\lVert v \rVert^2)}\right).$$

In Section \ref{sec:basic_geometry}, the gyrodistance between two
points in a gyrovector space is defined as
$d(u, v) = \llangle \ominus u \oplus v \rrangle$. Although
gyrodistance $d$ and distance $d'$ are not identical, they are related
by the expression $d'(u, v) = 2 \atanh(d(u, v))$. We have formally
proved this relation (the proof involves expressing inverse
trigonometric functions using logarithms, followed by calculation and
expression simplification). Consequently, if we define the distance
between two points in $\mathbb{P}$ as
$D(u, v) = 2 \atanh(\llangle \ominus u \oplus v \rrangle)$, we obtain
precisely the same distance as in the Poincar\'e disc model
$\mathbb{P'}$, making the two models geometrically equivalent.
Namely, since key geometric notions such as collinearity, lines,
betweenness, and others can be expressed in terms of distance (for
example, lines can be defined as geodesics), having an identical
distance function ensures the same underlying geometry. However,
rather than relying solely on this fact, we explicitly proved that
betweenness and collinearity coincide in both models.

Let us demonstrate that the betweenness relations coincide (the proof
for collinearity is done in a very similar way). Recall that
betweenness in gyrovector spaces is defined in Section
\ref{sec:basic_geometry}: point $x \in \mathbb{P}$ is between points
$u, v \in \mathbb{P}$ (we shall this by $\mathfrak{B}(u, x, v)$) if
there exists a real number $t \in [0, 1]$ such that
$x = u \oplus t \otimes (\ominus u \oplus v)$. In contrast, in
\cite{amai-poincare}, a point $x \in \mathbb{P}'$ is between points
$u, v \in \mathbb{P}'$ (we shall denote this by
$\mathfrak{B}'(u, x, v)$) if and only if the cross-ratio of the points
$u$, $x$, $v$, and the inversion of $x$ wrt. the unit circle is a real
negative number.

\begin{theorem}
  For any three points $u, v, x \in \mathbb{P}$ it holds that

  $$\mathfrak{B}(u, x, v) \longleftrightarrow \mathfrak{B}'(u, x, v).$$  
\end{theorem}
\begin{proof}
The proof would be very challenging without using
``without-loss-of-generality'' reasoning. Consider the translation
$z \mapsto \ominus u \oplus z$. As proved in Section
\ref{sec:basic_geometry}, since betweenness is invariant under such
translations, we have

$$\mathfrak{B}(u, x, v) \longleftrightarrow \mathfrak{B}(\ominus u \oplus u, \ominus u \oplus x, \ominus u \oplus v) \longleftrightarrow \mathfrak{B}(0, x', v'),$$

\noindent where $x' = \ominus u \oplus x$ and
$v' = \ominus u \oplus v$.

On the other hand, it can simply be shown that, in the representation
type of complex numbers, this translation is expressed by

$$z \mapsto \frac{z - u}{1 - \overline{u}z}.$$

In \cite{amai-poincare}, it was formally demonstrated that these
transformations, known as Blaschke factors, preserve many relations,
including betweenness. Therefore, we have

$$\mathfrak{B}'(u, x, v) \longleftrightarrow \mathfrak{B}'(0, x', v').$$

Thus, the problem reduces to comparing the two betweenness relations
in the special case when the first point is 0, i.e., proving that
$\mathfrak{B}(0, x', v') \longleftrightarrow \mathfrak{B}'(0, x',
v')$.

The case where $v' = 0$ is trivial, so we assume that $v' \neq
0$. From the definition of $\mathfrak{B}$, the left-hand side holds if
and only if there exists $t \in [0, 1]$ such that $x' = t \otimes
v'$. Using the characterization of $\otimes$, this holds if and only
if

$$x' = \frac{\tanh(t \cdot \atanh (\lVert v' \rVert))}{\lVert v' \rVert} v'.$$

By analyzing the properties of hyperbolic trigonometric functions, we
see that $t \in [0, 1]$ if and only if
$\frac{\tanh(t \cdot \atanh (\lVert v' \rVert))}{\lVert v' \rVert} \in
[0, 1]$. Therefore,

$$\mathfrak{B}(0, x', v') \longleftrightarrow (\exists t' \in [0, 1])(x' = t' \cdot v').$$

In \cite{amai-poincare}, it was formally proven that this condition is
equivalent to $x'$ being between $0$ and $v'$ according to the
cross-ratio-based definition of betweenness, i.e.,

$$(\exists t' \in [0, 1])(x' = t' \cdot v') \longleftrightarrow \mathfrak{B}'(0, x', v').$$

This concludes the proof.
\end{proof}

Since all functions and relations from the language of Tarski's axioms
coincide between the Poincar\'e disc and the M\"obius gyrovector
space, and the Poincar\'e disc satisfies all of Tarski's axioms for
hyperbolic geometry, it follows that the M\"obius gyrovector space
does as well. Thus, although these two structures are defined very
differently, they are essentially the same.

\section{Conclusions and further work}\label{sec:conclusions}

In this paper, we described our Isabelle/HOL formalization of
gyrogroups and gyrovector spaces \cite{ungar-analytic}. These
non-associative and non-commutative algebraic structures capture the
essence of both hyperbolic geometry and relativistic physics. By
cleverly hiding complicated computations under a few operation symbols
($\oplus$, $\otimes$), they allow for the definition of analytic
geometry in the hyperbolic plane in a syntactically almost identical
way to the Cartesian geometry that models the Euclidean plane.

We have formally defined gyrogroups and gyrovector spaces, proving
their numerous properties. Next, we defined two important gyrovector
spaces: M\"obius, inspired by hyperbolic geometry, and Einstein,
inspired by relativistic physics. Proving that these concrete
structures satisfy all the axioms of gyrovector spaces was
challenging, as many proofs are missing in the literature (often left
as ``exercises for the reader'' or ``left to be done with computer
algebra'' due to their technical and computational nature). Thus, our
formalization may help fill a gap in the literature about gyrovector
spaces. We have formally proved that M\"obius and Einstein gyrovector
spaces are isomorphic. This result enabled a significantly simpler
proof that Einstein's velocity addition and related operations satisfy
the axioms of gyrovector spaces, without the need to unfold the
complicated definition of this operation for each axiom.

Finally, we proved that the M\"obius gyrovector space is equivalent to
the Poincar\'e disc model (previously formalized in
\cite{amai-poincare}), and therefore is a model of Tarski's axioms for
hyperbolic geometry. This yields a new formal model of the Poincar\'e
disc, with a syntactically much cleaner definition than the classical
one (developed in the projective line $\mathbb{C}P^1$) and potentially
more convenient for further research. Since the Einstein gyrovector
space is isomorphic to the M\"obius one, we have effectively formally
proved that Einstein's theory of relativity is set in hyperbolic
geometry (a well-known, folklore, result, but to the best of our
knowledge, not formalized previously).

In our future work, we plan to enrich the theory of gyrogroups and
gyrovector spaces by proving additional theorems. We also plan to
establish the connections between the Einstein gyrospace and the
Klein-Beltrami model.

\bibliographystyle{plain}
\bibliography{gyro} % name your BibTeX data base

\end{document}
